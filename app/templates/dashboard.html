<!-- templates/dashboard.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
</head>
<body>
    <h1>Dashboard</h1>
    <form method="POST" action="/create_campaign">
        <input type="text" name="name" placeholder="Campaign Name" required>
        <select name="campaign_type">
            <option value="coupon">Coupon</option>
            <option value="score">Score</option>
        </select>
        <button type="submit">Create Campaign</button>
    </form>
    <h2>Your Campaigns</h2>
    <ul>
        {% for campaign in campaigns %}
        <li>
            <h2>{{ campaign.name }}</h2>
            {{ campaign.name }} - Total Coupons: {{ campaign.total_coupons }}, Used: {{ campaign.used_coupons }}, Remaining: {{ campaign.remaining_coupons }}
            <form method="POST" action="/upload_coupons/{{ campaign.id }}">
                <input type="text" name="codes" placeholder="Comma-separated coupon codes" required>
                <select name="type">
                    <option value="public">Public</option>
                    <option value="onetime">Onetime</option>
                </select>
                <input type="number" name="usage_limit" placeholder="Usage Limit (for public coupons)">
                <button type="submit">Upload Coupons</button>
            </form>
            <form method="POST" action="/select_games/{{ campaign.id }}">
                <label>Select Games:</label>
                {% for game in games %}
                    {% if campaign.campaign_type == game.type %}
                        <input type="checkbox" name="game_ids" value="{{ game.id }}">{{ game.name }}
                    {% endif %}
                {% endfor %}
                <button type="submit">Select Games</button>
            </form>
            <h3>Manage Webservice URL</h3>
            <form method="POST" action="/update_webservice_url/{{ campaign.id }}">
                <input type="text" name="webservice_url" value="{{ campaign.webservice_url }}" placeholder="Webservice URL">
                <button type="submit">Update URL</button>
            </form>
            <form method="POST" action="/delete_webservice_url/{{ campaign.id }}">
                <button type="submit">Delete URL</button>
            </form>
            <h4>Public Coupons</h4>
            <ul>
                {% for coupon in campaign.public_coupons %}
                <li>{{ coupon.code }} - Used: {{ coupon.usage_count }}/{{ coupon.usage_limit }}</li>
                {% endfor %}
            </ul>
            <h4>Onetime Coupons</h4>
            <ul>
                {% for coupon in campaign.onetime_coupons %}
                <li>{{ coupon.code }} - Used: {{ 'Yes' if coupon.used else 'No' }}</li>
                {% endfor %}
            </ul>
            <h4>Games</h4>
            <ul>
                {% for campaign_game in campaign.games %}
                <li>{{ campaign_game.game.name }} - Embed Code: {{ campaign_game.embed_code }}</li>
                {% endfor %}
            </ul>
            <h3>Upload Custom Game</h3>
            <form method="POST" action="/upload_custom_game/{{ campaign.id }}" enctype="multipart/form-data">
                <input type="text" name="game_name" placeholder="Game Name" required>
                <select name="game_type">
                    <option value="score">Score</option>
                    <option value="coupon">Coupon</option>
                <input type="file" name="game_file" accept=".html" required>
                <button type="submit">Upload Game</button>
            </form>
        </li>
        <hr></hr>
        <hr></hr>
        <hr></hr>
        {% endfor %}
    </ul>
    <script>
        function generateWidget(campaignId, gameId) {
            fetch(`/generate_widget/${campaignId}/${gameId}`)
                .then(response => response.json())
                .then(data => alert(`Embed Code: ${data.embed_code}`));
        }
    </script>
</body>
</html>